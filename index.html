<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>贪吃蛇2</title>
</head>

<body>
  <div class="area"></div>
  <div class="death"></div>



  <style>
    /* 去除默认样式 */
    * {
      margin: 0;
      padding: 0;
    }

    .area {
      /* 如果要改像素块记得更改区域大小 */
      width: 1000px;
      height: 1000px;
      display: grid;
      grid-template-columns: repeat(100, 10px);
      grid-auto-rows: 10px;
      gap: 0;
    }

    .death {
      font-size: 20px;
    }
  </style>
  <script>
    //获取元素
    const area = document.querySelector('.area')
    const death = document.querySelector('.death')

    // 数据流
    //原始坐标位置->(位移)->新的数据 渲染ui->（位移）->新的数据 获取ui


    //蛇 移动数组
    const snake = [[51, 50], [50, 50], [49, 50], [48, 50], [47, 50], [46, 50], [45, 50], [44, 50], [43, 50]]  //初始长度为9

    //判断arr里面有没有[x,y]
    function decide(arr, x, y) {
      //循环数组遍历
      for (let i = 0; i < arr.length; i++) {
        if (arr[i][0] === x && arr[i][1] === y) {
          return true
        }
      }
    }

    //每20s生成随机坐标
    //开局就有随机坐标的果实
    let apple = [Math.floor(Math.random() * 100),
    Math.floor(Math.random() * 100)]
    console.log('果实坐标', apple);

    const reward = setInterval(() => {
      //生成随机的奖励坐标
      //生成之前先清空坐标
      apple = []
      apple.push(Math.floor(Math.random() * 100))
      apple.push(Math.floor(Math.random() * 100))
      render()
    }, 20000)

    //渲染蛇 背景 和果实
    function render() {
      //区域用像素点
      let block = ''
      for (let x = 0; x < 100; x++) {
        for (let y = 0; y < 100; y++) {
          //渲染蛇
          if (decide(snake, x, y)) {
            block += '<div style="width: 10px;height: 10px; background-color:pink;"></div>'
          }
          //渲染红色apple
          else if (x === apple[0] && y === apple[1]) {
            block += '<div style="width: 10px;height: 10px; background-color:red;"></div>'
          }
          //渲染背景
          else {
            block += '<div style="width: 10px;height: 10px; background-color:skyblue;"></div>'
          }
        }
      }
      area.innerHTML = block
    }
    //开局就要渲染
    render()


    //默认移动方向
    let type = 'down'

    //监听方向键改变蛇移动方向
    document.addEventListener('keydown', function (e) {
      //按左键
      if (e.key === 'ArrowLeft') {
        type = 'left'
      }
      //按右键
      if (event.key === 'ArrowRight') {
        type = 'right'
      }
      //按上键
      if (event.key === 'ArrowUp') {
        type = 'up'
      }
      //按下键
      if (event.key === 'ArrowDown') {
        type = 'down'
      }
    })

    let timer = setInterval(() => {
      let a, b
      if (type === 'left') {
        a = 0, b = -1
      }
      else if (type === 'right') {
        a = 0, b = 1
      }
      else if (type === 'up') {
        a = -1, b = 0
      }
      else if (type === 'down') {
        a = 1, b = 0
      }
      snake.unshift([snake[0][0] + a, snake[0][1] + b])//蛇移动
      snake.pop()//蛇移动
      console.log('移动之后的蛇头坐标', snake[0][0], snake[0][1]);
      render()
      //这一秒蛇移动完之后判断
      //撞墙和撞自己 就触发死亡效果
      if (hitArea() || repeat()) {
        deathWarning()
      }
      //蛇吃果实
      else if (touch()) {
        snake.unshift([apple[0], apple[1]])
        apple = []
        console.log(snake.length);
      }
    }, 10)


    //如果蛇自己撞到自己就会死
    function repeat() {
      //不需要整个蛇判断重复 只需要判断要移动的目标点是否和旧蛇重复
      for (let i = 1; i < snake.length; i++) {
        if (snake[i][0] === snake[0][0] && snake[i][1] === snake[0][1]) {
          return true
        }
      }
    }

    //如果撞墙就死
    function hitArea() {
      for (let i = 0; i < snake.length; i++) {
        if (snake[i][0] === 100 || snake[i][1] === 100
          || snake[i][0] === 0 || snake[i][1] === 0) {
          console.log('撞墙死了');

          return true
          break
        }
      }
    }


    //触发死亡的效果
    function deathWarning() {
      clearInterval(reward)
      clearInterval(timer)
      death.innerHTML = `你死了 你的长度是${snake.length}`
    }

    //碰到果实判断
    function touch() {
      if (snake[0][0] === apple[0] && snake[0][1] === apple[1]) {
        console.log('判断吃食物的蛇头', snake[0][0], snake[0][1]);
        return true
      }
    }
  </script>
</body>

</html>