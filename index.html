<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>贪吃蛇2</title>
</head>

<body>
  <div class="area"></div>
  <div class="death"></div>
  <div class="controls">
    <button class="btn btn--pause">暂停</button>
    <button class="btn btn--restart">重开</button>
  </div>



  <style>
    /* 去除默认样式 */
    * {
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at 50% 40%, #1b103a 0%, #120a2b 50%, #0a0820 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    .area {
      /* 如果要改像素块记得更改区域大小 */
      width: 800px;
      height: 800px;
      display: grid;
      grid-template-columns: repeat(50, 16px);
      grid-auto-rows: 16px;
      gap: 0;
      margin-top: 48px;
      border-radius: 18px;
      background-color: rgba(12, 10, 26, 0.7);
      background-image:
        linear-gradient(to right, rgba(154, 108, 255, 0.15) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(154, 108, 255, 0.12) 1px, transparent 1px);
      background-size: 16px 16px;
      background-position: 0 0;
      border: 6px solid transparent;
      border-image: linear-gradient(90deg, #8a2be2, #00bfff) 1;
      box-shadow:
        0 0 24px rgba(138, 43, 226, 0.6),
        0 0 36px rgba(0, 191, 255, 0.5);
    }

    .death {
      font-size: 20px;
      width: 480px;
      height: 60px;
      margin: 50px 0;
      border-radius: 12px;
      background-color: rgba(255, 255, 255, 0.06);
      border: 2px solid transparent;
      border-image: linear-gradient(90deg, #8a2be2, #ff2bd6) 1;
      box-shadow:
        0 0 12px rgba(255, 43, 214, 0.6),
        0 0 20px rgba(255, 135, 231, 0.4);
      color: #ff87e7;
      display: flex;
      align-items: center;
      justify-content: center;
      text-shadow: 0 0 6px rgba(255, 135, 231, 0.6);
      font-family: "Noto Sans SC", "Microsoft YaHei", sans-serif;
    }

    .cell {
      width: 16px;
      height: 16px;
      background-color: rgba(135, 206, 235, 0.12);
    }

    .cell--snake {
      background: linear-gradient(180deg, #ff87e7, #ff2bd6);
      border-radius: 6px;
      box-shadow:
        0 0 8px rgba(255, 43, 214, 0.7),
        0 0 14px rgba(255, 135, 231, 0.5);
    }

    .cell--apple {
      background: radial-gradient(circle at 50% 40%, #ff7a7a 0%, #ff2b2b 80%, #b10000 100%);
      border-radius: 50%;
      box-shadow:
        0 0 6px rgba(255, 43, 43, 0.7),
        0 0 12px rgba(255, 122, 122, 0.5);
    }

    .controls {
      display: flex;
      gap: 12px;
      margin: 12px 0 0;
      width: 480px;
    }

    .btn {
      padding: 0 18px;
      height: 60px;
      border-radius: 12px;
      color: #d7b3ff;
      background-color: rgba(12, 10, 26, 0.6);
      border: 2px solid transparent;
      border-image: linear-gradient(90deg, #8a2be2, #00bfff) 1;
      box-shadow:
        0 0 10px rgba(138, 43, 226, 0.5),
        0 0 16px rgba(0, 191, 255, 0.4);
      font-family: "Noto Sans SC", "Microsoft YaHei", sans-serif;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex: 1;
    }

    .btn:hover {
      box-shadow:
        0 0 14px rgba(138, 43, 226, 0.7),
        0 0 20px rgba(0, 191, 255, 0.6);
      color: #ff87e7;
    }
  </style>
  <script>
    const area = document.querySelector('.area')
    const death = document.querySelector('.death')
    const btnPause = document.querySelector('.btn--pause')
    const btnRestart = document.querySelector('.btn--restart')

    // 数据流
    //原始坐标位置->(位移)->新的数据 渲染ui->（位移）->新的数据 获取ui


    //蛇 移动数组
    const snake = Array.from({ length: 10 }, (_, i) => [26 - i, 25])

    //判断arr里面有没有[x,y]
    function decide(arr, x, y) {
      //循环数组遍历
      for (let i = 0; i < arr.length; i++) {
        if (arr[i][0] === x && arr[i][1] === y) {
          return true
        }
      }
    }

    //每20s生成随机坐标
    //开局就有随机坐标的果实
    let apple = [Math.floor(Math.random() * 50), Math.floor(Math.random() * 50)]
    let reward
    function startReward() {
      reward = setInterval(() => {
        apple = []
        apple.push(Math.floor(Math.random() * 50))
        apple.push(Math.floor(Math.random() * 50))
        render()
      }, 20000)
    }
    startReward()

    //渲染蛇 背景 和果实
    function render() {
      //区域用像素点
      let block = ''
      for (let x = 0; x < 50; x++) {
        for (let y = 0; y < 50; y++) {
          //渲染蛇
          if (decide(snake, x, y)) {
            block += '<div class="cell cell--snake"></div>'
          }
          //渲染红色apple
          else if (x === apple[0] && y === apple[1]) {
            block += '<div class="cell cell--apple"></div>'
          }
          //渲染背景
          else {
            block += '<div class="cell"></div>'
          }
        }
      }
      area.innerHTML = block
    }
    //开局就要渲染
    render()
    death.innerHTML = `当前长度：${snake.length}`


    //默认移动方向
    let type = 'down'

    //监听方向键改变蛇移动方向
    document.addEventListener('keydown', function (e) {
      if (e.key === 'ArrowLeft') type = 'left'
      if (e.key === 'ArrowRight') type = 'right'
      if (e.key === 'ArrowUp') type = 'up'
      if (e.key === 'ArrowDown') type = 'down'
    })
    let timer
    function startTimer() {
      timer = setInterval(() => {
        let a, b
        if (type === 'left') {
          a = 0, b = -1
        }
        else if (type === 'right') {
          a = 0, b = 1
        }
        else if (type === 'up') {
          a = -1, b = 0
        }
        else if (type === 'down') {
          a = 1, b = 0
        }
        snake.unshift([snake[0][0] + a, snake[0][1] + b])
        snake.pop()
        console.log('移动之后的蛇头坐标', snake[0][0], snake[0][1]);
        render()
        death.innerHTML = `当前长度：${snake.length}`
        if (hitArea() || repeat()) {
          deathWarning()
        }
        else if (touch()) {
          snake.unshift([apple[0], apple[1]])
          apple = []
          console.log(snake.length);
        }
      }, 60)
    }
    startTimer()
    let paused = false
    btnPause && btnPause.addEventListener('click', () => {
      if (!paused) {
        paused = true
        clearInterval(timer)
        death.innerHTML = `已暂停 · 当前长度：${snake.length}`
        btnPause.textContent = '继续'
      } else {
        paused = false
        startTimer()
        btnPause.textContent = '暂停'
      }
    })
    btnRestart && btnRestart.addEventListener('click', () => {
      clearInterval(timer)
      clearInterval(reward)
      snake.length = 0
      for (let i = 0; i < 10; i++) {
        snake.push([26 - i, 25])
      }
      type = 'down'
      apple = [Math.floor(Math.random() * 50), Math.floor(Math.random() * 50)]
      render()
      death.innerHTML = `当前长度：${snake.length}`
      startReward()
      startTimer()
      paused = false
      if (btnPause) btnPause.textContent = '暂停'
    })


    //如果蛇自己撞到自己就会死
    function repeat() {
      //不需要整个蛇判断重复 只需要判断要移动的目标点是否和旧蛇重复
      for (let i = 1; i < snake.length; i++) {
        if (snake[i][0] === snake[0][0] && snake[i][1] === snake[0][1]) {
          return true
        }
      }
    }

    //如果撞墙就死
    function hitArea() {
      for (let i = 0; i < snake.length; i++) {
        if (snake[i][0] === 50 || snake[i][1] === 50
          || snake[i][0] === 0 || snake[i][1] === 0) {
          console.log('撞墙死了');

          return true
          break
        }
      }
    }


    //触发死亡的效果
    function deathWarning() {
      clearInterval(reward)
      clearInterval(timer)
      death.innerHTML = `你死了 你的长度是${snake.length}`
    }

    //碰到果实判断
    function touch() {
      if (snake[0][0] === apple[0] && snake[0][1] === apple[1]) {
        console.log('判断吃食物的蛇头', snake[0][0], snake[0][1]);
        return true
      }
    }
  </script>

</html>